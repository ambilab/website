---
import { SITE } from '@config/site';
import { DEFAULT_LOCALE } from '@i18n/config.ts';
import { getTranslation } from '@i18n/translations';
import type { Locale } from '@type/locale';

interface SocialLink {
    name: string;
    url: string;
}

export interface Props {
    locale?: Locale;
}

const { locale: localeProp } = Astro.props as Partial<Props>;
const locale: Locale = localeProp ?? DEFAULT_LOCALE;
const t = getTranslation(locale);

const socialLinks: SocialLink[] = [{ name: 'GitHub', url: SITE.SOCIAL.GITHUB }];
---

<div class="flex flex-wrap gap-1">
    {
        socialLinks.map((link) => (
            <a
                href={link.url}
                target="_blank"
                rel="noopener noreferrer"
                aria-label={`${link.name} (${t.a11y.opensInNewTab})`}
                class="border border-zinc-200 px-[7px] py-[5px]"
                data-track-platform={link.name}
            >
                {link.name}
            </a>
        ))
    }
</div>

<script>
    function handleSocialClick(event: MouseEvent, link: HTMLAnchorElement): void {
        if (event.button !== 0 && event.button !== 1) return;

        const platform = link.dataset.trackPlatform;
        if (platform && typeof window.plausible === 'function') {
            try {
                window.plausible('Social Link Click', { props: { platform } });
            } catch {
                // Silently swallow tracking errors.
            }
        }
    }

    document.querySelectorAll<HTMLAnchorElement>('[data-track-platform]').forEach((link) => {
        link.addEventListener('click', (e) => handleSocialClick(e, link));
        link.addEventListener('auxclick', (e) => handleSocialClick(e, link));
    });
</script>
