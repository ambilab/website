---
import { getRoute } from '@config/routes';
import { getTranslation } from '@i18n/translations';
import type { Locale } from '@type/locale';
import { normalizeSlug } from '@utils/content-loader';
import { formatDate } from '@utils/formatDate';
import type { CollectionEntry } from 'astro:content';

export interface Props {
    posts: CollectionEntry<'news'>[];
    locale: Locale;
    limit?: number;
}

const { posts, locale, limit } = Astro.props as Props;
const t = getTranslation(locale);
const hasLimit = typeof limit === 'number';
const displayPosts = hasLimit ? posts.slice(0, Math.max(0, limit)) : posts;
---

{
    displayPosts.length === 0 ? (
        <p class="meta">{t.news.noPosts}</p>
    ) : (
        <div class="select-none space-y-8">
            {displayPosts.map((post) => {
                const postSlug = normalizeSlug(post.id);
                const postUrl = `${getRoute('news', locale)}/${postSlug}`;

                return (
                    <a href={postUrl} aria-label={post.data.title}>
                        <article class="card card-shadows">
                            <h2>{post.data.title}</h2>

                            <div class="meta">
                                <time datetime={post.data.pubDate.toISOString()}>
                                    {formatDate(post.data.pubDate, locale)}
                                </time>
                            </div>

                            <p>{post.data.description}</p>
                        </article>
                    </a>
                );
            })}
        </div>
    )
}
